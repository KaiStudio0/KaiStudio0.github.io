<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aura RNG Game - Extended</title>
  <style>
    /* Estilos generales y fuentes */
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Orbitron', monospace;
      background: linear-gradient(135deg, #0f0f23, #1a1a3a, #2d1b69);
      color: #fff;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }
    .background-animation {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
      background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3), transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3), transparent 50%),
                  radial-gradient(circle at 40% 80%, rgba(119, 198, 255, 0.3), transparent 50%);
      animation: backgroundPulse 4s ease-in-out infinite alternate;
    }
    @keyframes backgroundPulse { 0% { opacity: 0.5; } 100% { opacity: 0.8; } }

    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    /* Cabecera y botones de Reset y datos de usuario */
    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
      position: relative;
    }
    .header h1 {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientShift 3s ease infinite;
      text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
    }
    @keyframes gradientShift {
      0%,100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .user-info { position: absolute; top: 10px; right: 20px; text-align: right; }
    .user-info img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
    .reset-btn { position: absolute; top: 10px; left: 20px; background: #f44336; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
    
    /* Tabs */
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .tab {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      padding: 15px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    .tab:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(255,255,255,0.2); }
    .tab.active { background: linear-gradient(45deg, #ff6b6b, #4ecdc4); border-color: #fff; box-shadow: 0 0 30px rgba(255,255,255,0.3); }
    .tab-content { display: none; }
    .tab-content.active { display: block; text-align: center; }
    
    /* Secci√≥n principal del juego (Main) */
    .stats-bar {
      display: flex; justify-content: center; gap: 30px; margin: 20px 0; flex-wrap: wrap;
    }
    .stat {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 15px 25px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .stat-value { font-size: 1.5rem; font-weight: 700; color: #ffd700; }
    .stat-label { font-size: 0.9rem; opacity: 0.8; }
    
    .roll-section {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 25px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }
    .roll-animation {
      width: 300px; height: 200px; margin: 30px auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 20px;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      border: 2px solid rgba(255,255,255,0.2);
      position: relative; overflow: hidden;
    }
    .aura-name { font-size: 1.8rem; font-weight: 700; margin-bottom: 10px; text-shadow: 0 0 20px currentColor; }
    .aura-rarity { font-size: 1rem; opacity: 0.9; padding: 5px 15px; border-radius: 15px; background: rgba(255, 255, 255, 0.1); }
    
    .roll-buttons { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
    .btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      color: white;
      padding: 15px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(102,126,234,0.3);
      position: relative; overflow: hidden;
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(102,126,234,0.5); }
    .btn:active { transform: translateY(0); }
    
    /* Botones espec√≠ficos */
    .btn-roll { background: linear-gradient(45deg, #ff6b6b, #ee5a24); box-shadow: 0 8px 25px rgba(255,107,107,0.3); }
    .btn-auto { background: linear-gradient(45deg, #4ecdc4, #44a08d); box-shadow: 0 8px 25px rgba(78,205,196,0.3); }
    .btn-quick { background: linear-gradient(45deg, #45b7d1, #2980b9); box-shadow: 0 8px 25px rgba(69,183,209,0.3); }
    
    /* Estilos para pantallas modales, por ejemplo login */
    .modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex; justify-content: center; align-items: center;
      z-index: 2000;
    }
    .modal-content {
      background: #1a1a3a;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .modal input { padding: 10px; margin: 10px 0; border-radius: 5px; width: 80%; }
    .modal button { padding: 10px 20px; border: none; border-radius: 5px; background: #4ecdc4; color: #fff; cursor: pointer; }
    
    /* Inventario, tienda y otros se estructuran igual que antes */
    .shop-content, .inventory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    .shop-section, .inventory-item {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 25px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
      text-align: center;
    }
    .shop-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; color: #ffd700; }
    .item-price { color: #ffd700; font-weight: 700; }
    
    /* Clases de rareza (la mayor√≠a se usan para el inventario) */
    .rarity-common { border-color: #95a5a6; color: #95a5a6; }
    .rarity-rare { border-color: #3498db; color: #3498db; }
    .rarity-epic { border-color: #9b59b6; color: #9b59b6; }
    .rarity-legendary { border-color: #f39c12; color: #f39c12; }
    .rarity-mythic { border-color: #e74c3c; color: #e74c3c; }
    .rarity-divine { border-color: #fd79a8; color: #fd79a8; }
    .rarity-celestial { border-color: #00cec9; color: #00cec9; }
    .rarity-transcendent { border-color: #6c5ce7; color: #6c5ce7; }
    .rarity-omnipotent { border-color: #ffd700; color: #ffd700; }
    /* Nuevas rarezas */
    .rarity-ethereal { border-color: #a29bfe; color: #a29bfe; }
    .rarity-fabled { border-color: #fd79a8; color: #fd79a8; }
    .rarity-ascended { border-color: #55efc4; color: #55efc4; }
    .rarity-infinite { border-color: #ffeaa7; color: #ffeaa7; }
    
    /* Animaciones de part√≠culas y shake (igual que antes) */
    .particles { position: absolute; width: 100%; height: 100%; overflow: hidden; }
    .particle {
      position: absolute; width: 4px; height: 4px; background: #ffd700; border-radius: 50%;
      animation: particleFall 2s linear forwards;
    }
    @keyframes particleFall { to { transform: translateY(100vh); opacity: 0; } }
    .rolling { animation: rollSpin 1s linear infinite; }
    @keyframes rollSpin { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }
    
    @media (max-width: 768px) {
      .title { font-size: 2rem; }
      .stats-bar { flex-direction: column; align-items: center; }
      .roll-buttons { flex-direction: column; align-items: center; }
      .shop-content { grid-template-columns: 1fr; }
    }
    
    /* Shake animation para efectos especiales */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%,30%,50%,70%,90% { transform: translateX(-5px); }
      20%,40%,60%,80% { transform: translateX(5px); }
    }
  </style>
</head>
<body>
  <div class="background-animation"></div>
  
  <!-- Modal de Login - se muestra si el usuario no ha ingresado -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <h2>¬°Bienvenido!</h2>
      <p>Ingresa tu nombre de usuario y selecciona un avatar para entrar.</p>
      <input type="text" id="usernameInput" placeholder="Tu nombre" />
      <input type="file" id="avatarInput" accept="image/*" />
      <button onclick="loginUser()">Entrar</button>
    </div>
  </div>
  
  <button class="reset-btn" onclick="resetData()">Reset Data</button>
  
  <div class="container">
    <div class="header">
      <h1 class="title">‚ú® AURA RNG GAME ‚ú®</h1>
      <div class="stats-bar">
        <div class="stat">
          <div class="stat-value" id="coins">1000</div>
          <div class="stat-label">üí∞ Monedas</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="luck">1.0x</div>
          <div class="stat-label">üçÄ Suerte</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="rolls">0</div>
          <div class="stat-label">üé≤ Rolls</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="auras-count">0</div>
          <div class="stat-label">‚ú® Auras</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="prestigeLevel">0</div>
          <div class="stat-label">üèÜ Prestigio</div>
        </div>
      </div>
    </div>
    
    <!-- Informaci√≥n del usuario -->
    <div class="user-info" id="userInfo" style="display:none;">
      <div id="displayUsername"></div>
      <img id="displayAvatar" src="" alt="Avatar" />
    </div>
    
    <!-- Pesta√±as de navegaci√≥n -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('main', event)">üéÆ Main</button>
      <button class="tab" onclick="switchTab('shop', event)">üõí Shop</button>
      <button class="tab" onclick="switchTab('inventory', event)">üì¶ Inventario</button>
      <button class="tab" onclick="switchTab('prestige', event)">üèÜ Prestigio</button>
      <button class="tab" onclick="switchTab('achievements', event)">üéñÔ∏è Logros</button>
      <button class="tab" onclick="switchTab('leaderboard', event)">üìä Leaderboard</button>
      <button class="tab" onclick="switchTab('codes', event)">üîë C√≥digos</button>
    </div>
    
    <!-- Contenido de cada pesta√±a -->
    <div id="main-tab" class="tab-content active">
      <div class="main-content">
        <div class="roll-section">
          <div class="roll-animation" id="rollAnimation">
            <div class="aura-name" id="auraName">¬°Haz tu primer roll!</div>
            <div class="aura-rarity" id="auraRarity">Presiona Roll para comenzar</div>
          </div>
          <div class="roll-buttons">
            <button class="btn btn-roll" onclick="roll()">üé≤ Roll (50 monedas)</button>
            <button class="btn btn-auto" onclick="toggleAutoRoll()">‚ö° Auto Roll</button>
            <button class="btn btn-quick" onclick="quickRoll()">üí® Quick Roll (500 monedas)</button>
          </div>
          <div class="auto-roll-controls" id="autoRollControls" style="display:none;">
            <button class="btn" onclick="stopAutoRoll()">‚èπÔ∏è Detener Auto Roll</button>
            <p>Auto Roll Activo - Velocidad: <span id="autoRollSpeed">1</span> rolls/segundo</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Shop: Se muestran mejoras de suerte y pociones (se han eliminado las que pediste borrar y se a√±aden nuevas) -->
    <div id="shop-tab" class="tab-content">
      <div class="shop-content">
        <div class="shop-section">
          <h2 class="shop-title">üçÄ Mejoras de Suerte (Permanentes)</h2>
          <div class="shop-item">
            <div class="item-info">
              <h3>Amuleto B√°sico</h3>
              <p>+0.1x Suerte</p>
            </div>
            <div>
              <div class="item-price">1,000 monedas</div>
              <button class="btn" onclick="buyLuckUpgrade(0.1, 1000)">Comprar</button>
            </div>
          </div>
          <div class="shop-item">
            <div class="item-info">
              <h3>Tr√©bol Dorado</h3>
              <p>+0.5x Suerte</p>
            </div>
            <div>
              <div class="item-price">5,000 monedas</div>
              <button class="btn" onclick="buyLuckUpgrade(0.5, 5000)">Comprar</button>
            </div>
          </div>
          <div class="shop-item">
            <div class="item-info">
              <h3>Herradura M√≠tica</h3>
              <p>+1.0x Suerte</p>
            </div>
            <div>
              <div class="item-price">15,000 monedas</div>
              <button class="btn" onclick="buyLuckUpgrade(1.0, 15000)">Comprar</button>
            </div>
          </div>
          <!-- Otras mejoras se pueden a√±adir -->
        </div>
        
        <div class="shop-section">
          <h2 class="shop-title">üß™ Pociones (Temporales y de un solo uso)</h2>
          <div class="shop-item">
            <div class="item-info">
              <h3>Poci√≥n de Suerte</h3>
              <p>+2.0x Suerte por 1 minuto</p>
            </div>
            <div>
              <div class="item-price">500 monedas</div>
              <button class="btn" onclick="buyPotion(2,60000,500)">Comprar</button>
            </div>
          </div>
          <div class="shop-item">
            <div class="item-info">
              <h3>Elixir Divino</h3>
              <p>+5.0x Suerte por 30 segundos</p>
            </div>
            <div>
              <div class="item-price">2,000 monedas</div>
              <button class="btn" onclick="buyPotion(5,30000,2000)">Comprar</button>
            </div>
          </div>
          <!-- Nueva secci√≥n de pociones OP de un solo uso -->
          <div class="shop-item">
            <div class="item-info">
              <h3>Poci√≥n OP Instant√°nea</h3>
              <p>+10.0x Suerte por 15 segundos (Uso √önico)</p>
            </div>
            <div>
              <div class="item-price">3,000 monedas</div>
              <button class="btn" onclick="buyOneUsePotion(10,15000,3000)">Comprar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Inventario -->
    <div id="inventory-tab" class="tab-content">
      <div class="shop-section">
        <h2 class="shop-title">üì¶ Tu Inventario de Auras</h2>
        <div class="inventory-grid" id="inventoryGrid">
          <p style="text-align: center; opacity: 0.7; grid-column: 1/-1;">
            Tu inventario est√° vac√≠o. ¬°Haz algunos rolls para conseguir auras!
          </p>
        </div>
      </div>
    </div>
    
    <!-- Pesta√±a de Prestigio -->
    <div id="prestige-tab" class="tab-content">
      <h2>Prestigio</h2>
      <p>Prestigio acumulado: <span id="prestigeDisplay">0</span></p>
      <button class="btn" onclick="prestigeGame()">Prestigiar (Reinicia a cambio de bono de suerte)</button>
    </div>
    
    <!-- Pesta√±a de Logros -->
    <div id="achievements-tab" class="tab-content">
      <h2>üéñÔ∏è Logros</h2>
      <div id="achievementsList">
        <p>No has conseguido logros a√∫n.</p>
      </div>
    </div>
    
    <!-- Pesta√±a de Leaderboard -->
    <div id="leaderboard-tab" class="tab-content">
      <h2>üìä Leaderboard</h2>
      <div id="leaderboardList">
        <p>No hay datos a√∫n.</p>
      </div>
    </div>
    
    <!-- Pesta√±a de C√≥digos -->
    <div id="codes-tab" class="tab-content">
      <h2>üîë Canjear C√≥digo</h2>
      <input type="text" id="codeInput" placeholder="Ingresa tu c√≥digo" />
      <button class="btn" onclick="redeemCode()">Canjear</button>
      <div id="codeMessage"></div>
    </div>
  </div>
  
  <!-- Overlay para animaciones especiales -->
  <div class="animation-overlay" id="animationOverlay" style="display: none;">
    <div class="particles" id="particles"></div>
  </div>
  
  <script>
    //////////////////////////////
    // Estado inicial del juego
    //////////////////////////////
    let gameState = {
      coins: 1000,
      luck: 1.0,
      totalRolls: 0,
      auras: [],
      autoRollActive: false,
      autoRollInterval: null,
      prestige: 0,
      achievements: [],
      codesRedeemed: [],
      potionActive: false,
      potionMultiplier: 0,
      potionEndTime: 0,
      oneUsePotions: 0,
      username: null,
      avatar: null,
      bestAura: 0  // para leaderboard
    };
    
    //////////////////////////////
    // Auras y rarezas
    //////////////////////////////
    // Auras originales y luego se a√±aden 4 nuevas rarezas
    let auras = [
      // Common
      {name: "Brisa Com√∫n", rarity: "Common", minValue: 1, maxValue: 100, color: "#95a5a6", chance: 40},
      {name: "Luz B√°sica", rarity: "Common", minValue: 1, maxValue: 100, color: "#95a5a6", chance: 35},
      // Rare  
      {name: "Viento Azul", rarity: "Rare", minValue: 101, maxValue: 1000, color: "#3498db", chance: 15},
      {name: "Chispa El√©ctrica", rarity: "Rare", minValue: 101, maxValue: 1000, color: "#3498db", chance: 12},
      // Epic
      {name: "Llama P√∫rpura", rarity: "Epic", minValue: 1001, maxValue: 10000, color: "#9b59b6", chance: 8},
      {name: "Cristal M√≠stico", rarity: "Epic", minValue: 1001, maxValue: 10000, color: "#9b59b6", chance: 6},
      // Legendary
      {name: "Oro Radiante", rarity: "Legendary", minValue: 10001, maxValue: 100000, color: "#f39c12", chance: 3},
      {name: "F√©nix Dorado", rarity: "Legendary", minValue: 10001, maxValue: 100000, color: "#f39c12", chance: 2},
      // Mythic
      {name: "Drag√≥n Carmes√≠", rarity: "Mythic", minValue: 100001, maxValue: 1000000, color: "#e74c3c", chance: 1},
      {name: "Tormenta Eterna", rarity: "Mythic", minValue: 100001, maxValue: 1000000, color: "#e74c3c", chance: 0.8},
      // Divine
      {name: "Aurora Divina", rarity: "Divine", minValue: 1000001, maxValue: 100000000, color: "#fd79a8", chance: 0.5},
      {name: "Estrella Celestial", rarity: "Divine", minValue: 1000001, maxValue: 100000000, color: "#fd79a8", chance: 0.3},
      // Celestial
      {name: "Galaxia Infinita", rarity: "Celestial", minValue: 100000001, maxValue: 1000000000, color: "#00cec9", chance: 0.1},
      {name: "Cosmos Eterno", rarity: "Celestial", minValue: 100000001, maxValue: 1000000000, color: "#00cec9", chance: 0.08},
      // Transcendent
      {name: "Omnipresencia", rarity: "Transcendent", minValue: 1000000001, maxValue: 10000000000, color: "#6c5ce7", chance: 0.05},
      {name: "Realidad Absoluta", rarity: "Transcendent", minValue: 1000000001, maxValue: 10000000000, color: "#6c5ce7", chance: 0.03},
      // Omnipotent
      {name: "DIOS SUPREMO", rarity: "Omnipotent", minValue: 10000000001, maxValue: 100000000000, color: "#ffd700", chance: 0.01},
      {name: "CREADOR UNIVERSAL", rarity: "Omnipotent", minValue: 10000000001, maxValue: 100000000000, color: "#ffd700", chance: 0.005},
      // Nuevas rarezas agregadas
      {name: "Esencia Et√©rea", rarity: "Ethereal", minValue: 100000000001, maxValue: 1000000000000, color: "#a29bfe", chance: 0.002},
      {name: "Luz Et√©rea", rarity: "Ethereal", minValue: 100000000001, maxValue: 1000000000000, color: "#a29bfe", chance: 0.0015},
      {name: "Susurro Fabuloso", rarity: "Fabled", minValue: 1000000000001, maxValue: 10000000000000, color: "#fd79a8", chance: 0.001},
      {name: "Leyenda Fabulosa", rarity: "Fabled", minValue: 1000000000001, maxValue: 10000000000000, color: "#fd79a8", chance: 0.0008},
      {name: "Alba Ascendida", rarity: "Ascended", minValue: 10000000000001, maxValue: 100000000000000, color: "#55efc4", chance: 0.0005},
      {name: "Crep√∫sculo Ascendido", rarity: "Ascended", minValue: 10000000000001, maxValue: 100000000000000, color: "#55efc4", chance: 0.0004},
      {name: "Infinito", rarity: "Infinite", minValue: 100000000000001, maxValue: 1000000000000000, color: "#ffeaa7", chance: 0.0002},
      {name: "Eternidad", rarity: "Infinite", minValue: 100000000000001, maxValue: 1000000000000000, color: "#ffeaa7", chance: 0.0001}
    ];
    
    //////////////////////////////
    // Sonidos y animaciones
    //////////////////////////////
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(frequency, duration, type = 'sine') {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      oscillator.frequency.value = frequency;
      oscillator.type = type;
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration);
    }
    
    //////////////////////////////
    // Funciones de Guardado y Carga (con localStorage)
    //////////////////////////////
    function saveGame() {
      localStorage.setItem("auraGameSave", JSON.stringify(gameState));
      updateLeaderboard(); // Actualiza leaderboard si corresponde
    }
    
    function loadGame() {
      const saveData = localStorage.getItem("auraGameSave");
      if (saveData) {
        try {
          let loaded = JSON.parse(saveData);
          gameState = { ...gameState, ...loaded };
          updateUI();
          updateInventory();
          updateAchievements();
          updateLeaderboard();
          // Si ya hab√≠as ingresado, oculta el login
          if (gameState.username) {
            document.getElementById("loginModal").style.display = "none";
            document.getElementById("userInfo").style.display = "block";
            document.getElementById("displayUsername").textContent = gameState.username;
            if (gameState.avatar) { document.getElementById("displayAvatar").src = gameState.avatar; }
          }
        } catch(e) {
          console.error("Error al cargar el save.");
        }
      }
    }
    
    // Auto-save cada 30 segundos
    setInterval(saveGame, 30000);
    
    //////////////////////////////
    // Login y Reset Data
    //////////////////////////////
    function loginUser() {
      const username = document.getElementById("usernameInput").value.trim();
      const avatarFile = document.getElementById("avatarInput").files[0];
      if (!username) { alert("Ingresa un nombre de usuario."); return; }
      gameState.username = username;
      if (avatarFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          gameState.avatar = e.target.result;
          document.getElementById("displayAvatar").src = gameState.avatar;
          finalizeLogin();
        };
        reader.readAsDataURL(avatarFile);
      } else {
        finalizeLogin();
      }
    }
    
    function finalizeLogin() {
      document.getElementById("loginModal").style.display = "none";
      document.getElementById("userInfo").style.display = "block";
      document.getElementById("displayUsername").textContent = gameState.username;
      saveGame();
    }
    
    function resetData() {
      if(confirm("¬øEst√°s seguro de reiniciar todos los datos?")) {
        localStorage.removeItem("auraGameSave");
        location.reload();
      }
    }
    
    //////////////////////////////
    // Actualizaci√≥n de UI
    //////////////////////////////
    function updateUI() {
      document.getElementById("coins").textContent = gameState.coins.toLocaleString();
      document.getElementById("luck").textContent = getTotalLuck().toFixed(1) + "x";
      document.getElementById("rolls").textContent = gameState.totalRolls.toLocaleString();
      document.getElementById("auras-count").textContent = gameState.auras.length.toLocaleString();
      document.getElementById("prestigeLevel").textContent = gameState.prestige;
    }
    
    function getTotalLuck() {
      let total = gameState.luck;
      if (gameState.potionActive && Date.now() < gameState.potionEndTime) {
        total += gameState.potionMultiplier;
      }
      return total;
    }
    
    //////////////////////////////
    // Sistema RNG mejorado
    //////////////////////////////
    function roll() {
      if (gameState.coins < 50) {
        playSound(200, 0.3);
        alert("¬°No tienes suficientes monedas!");
        return;
      }
      gameState.coins -= 50;
      gameState.totalRolls++;
      playSound(400, 0.2);
      document.getElementById("rollAnimation").classList.add("rolling");
      setTimeout(() => {
        const result = performRoll();
        displayRollResult(result);
        document.getElementById("rollAnimation").classList.remove("rolling");
        updateUI();
        updateAchievements();
      }, 1000);
    }
    
    function performRoll() {
      const totalLuck = getTotalLuck();
      // Ajuste de chance de forma lineal con la suerte
      let weightedAuras = auras.map(aura => ({
        ...aura,
        adjustedChance: aura.chance * totalLuck
      }));
      const totalWeight = weightedAuras.reduce((sum, aura) => sum + aura.adjustedChance, 0);
      let random = Math.random() * totalWeight;
      for (let aura of weightedAuras) {
        random -= aura.adjustedChance;
        if (random <= 0) {
          const value = Math.floor(Math.random() * (aura.maxValue - aura.minValue + 1)) + aura.minValue;
          const newAura = { ...aura, value: value, id: Date.now() + Math.random() };
          gameState.auras.push(newAura);
          // Recompensa por el roll seg√∫n el valor
          gameState.coins += Math.floor(value / 10);
          // Actualiza bestAura para leaderboard
          if (value > gameState.bestAura) { gameState.bestAura = value; }
          return newAura;
        }
      }
      // Fallback
      const fallback = weightedAuras[0];
      const value = Math.floor(Math.random() * (fallback.maxValue - fallback.minValue + 1)) + fallback.minValue;
      const newAura = { ...fallback, value: value, id: Date.now() + Math.random() };
      gameState.auras.push(newAura);
      gameState.coins += Math.floor(value / 10);
      return newAura;
    }
    
    function displayRollResult(aura) {
      const auraName = document.getElementById("auraName");
      const auraRarity = document.getElementById("auraRarity");
      auraName.textContent = aura.name;
      auraName.style.color = aura.color;
      auraRarity.textContent = `${aura.rarity} - Valor: ${aura.value.toLocaleString()}`;
      auraRarity.style.backgroundColor = aura.color + "20";
      auraRarity.style.borderColor = aura.color;
      
      // Animaciones en funci√≥n del valor
      if(aura.value >= 1000000000) {
        triggerSpecialAnimation(aura);
        playSound(800,2,"sawtooth");
      } else if(aura.value >= 100000000) {
        triggerUltraAnimation(aura);
        playSound(700,1.5,"square");
      } else if(aura.value >= 1000000) {
        triggerMegaAnimation(aura);
        playSound(600,1,"triangle");
      } else if(aura.value >= 100000) {
        triggerAnimation(aura);
        playSound(500,0.8);
      } else if(aura.value >= 10000) {
        triggerBasicAnimation(aura);
        playSound(450,0.5);
      }
      updateInventory();
      updateLeaderboard();
    }
    
    function triggerBasicAnimation(aura) { createParticles(20, aura.color); }
    function triggerAnimation(aura) {
      createParticles(50, aura.color);
      const overlay = document.getElementById("animationOverlay");
      overlay.style.display = "block";
      overlay.style.background = `radial-gradient(circle, ${aura.color}20, transparent 70%)`;
      setTimeout(() => { overlay.style.display = "none"; }, 2000);
    }
    function triggerMegaAnimation(aura) {
      createParticles(100, aura.color);
      const overlay = document.getElementById("animationOverlay");
      overlay.innerHTML = `
        <div class="particles" id="particles"></div>
        <div class="mega-animation" style="color: ${aura.color}; text-shadow: 0 0 50px ${aura.color};">
          ‚ú® ${aura.name.toUpperCase()} ‚ú®
          <div style="font-size: 2rem; margin-top: 20px;">MEGA RARE!</div>
        </div>
      `;
      overlay.style.display = "block";
      overlay.style.background = `radial-gradient(circle, ${aura.color}30, transparent 70%)`;
      setTimeout(() => { overlay.style.display = "none"; }, 3000);
      createParticles(100,aura.color);
    }
    function triggerUltraAnimation(aura) {
      createParticles(200, aura.color);
      const overlay = document.getElementById("animationOverlay");
      overlay.innerHTML = `
        <div class="particles" id="particles"></div>
        <div class="mega-animation ultra-animation" style="color: ${aura.color}; text-shadow: 0 0 80px ${aura.color};">
          üåü ${aura.name.toUpperCase()} üåü
          <div style="font-size: 2.5rem; margin-top: 20px;">ULTRA LEGENDARY!</div>
          <div style="font-size: 1.5rem; margin-top: 10px;">Valor: ${aura.value.toLocaleString()}</div>
        </div>
      `;
      overlay.classList.add("ultra-animation");
      overlay.style.display = "block";
      setTimeout(() => { 
        overlay.style.display = "none"; 
        overlay.classList.remove("ultra-animation"); 
      }, 3000);
      document.body.style.animation = "shake 0.5s ease-in-out";
      setTimeout(() => { document.body.style.animation = ""; }, 500);
    }
    function triggerSpecialAnimation(aura) {
      createParticles(500, aura.color);
      const overlay = document.getElementById("animationOverlay");
      overlay.innerHTML = `
        <div class="particles" id="particles"></div>
        <div class="mega-animation special-animation" style="color: #fff; text-shadow: 0 0 100px ${aura.color}, 0 0 200px #fff;">
          ‚≠ê ${aura.name.toUpperCase()} ‚≠ê
          <div style="font-size: 3rem; margin-top: 20px;">GODLIKE!</div>
          <div style="font-size: 2rem; margin-top: 15px;">Valor: ${aura.value.toLocaleString()}</div>
          <div style="font-size: 1.2rem; margin-top: 10px;">¬°IMPOSIBLE!</div>
        </div>
      `;
      overlay.classList.add("special-animation");
      overlay.style.display = "block";
      setTimeout(() => { 
        overlay.style.display = "none"; 
        overlay.classList.remove("special-animation"); 
      }, 4000);
      document.body.style.animation = "shake 2s ease-in-out";
      setTimeout(() => { document.body.style.animation = ""; }, 2000);
    }
    
    function createParticles(count, color) {
      const particles = document.getElementById("particles");
      for (let i = 0; i < count; i++) {
        const particle = document.createElement("div");
        particle.className = "particle";
        particle.style.left = Math.random() * 100 + "%";
        particle.style.backgroundColor = color || "#ffd700";
        particle.style.animationDelay = Math.random() * 2 + "s";
        particle.style.animationDuration = (Math.random() * 3 + 2) + "s";
        particles.appendChild(particle);
        setTimeout(() => { if(particle.parentNode) particle.parentNode.removeChild(particle); }, 5000);
      }
    }
    
    function quickRoll() {
      if (gameState.coins < 500) {
        playSound(200,0.3);
        alert("¬°No tienes suficientes monedas para Quick Roll!");
        return;
      }
      gameState.coins -= 500;
      gameState.totalRolls += 10;
      playSound(600,0.3,"square");
      document.getElementById("rollAnimation").classList.add("rolling");
      let results = [];
      for (let i = 0; i < 10; i++) { results.push(performRoll()); }
      setTimeout(() => {
        let bestResult = results.reduce((best, curr) => (curr.value > best.value ? curr : best));
        displayRollResult(bestResult);
        document.getElementById("rollAnimation").classList.remove("rolling");
        updateUI();
        alert(`Quick Roll completado! Mejor resultado: ${bestResult.name} (${bestResult.value.toLocaleString()})`);
      }, 1500);
    }
    
    function toggleAutoRoll() {
      if(gameState.autoRollActive){ stopAutoRoll(); }
      else { startAutoRoll(); }
    }
    
    function startAutoRoll() {
      if(gameState.coins < 50) {
        playSound(200,0.3);
        alert("¬°No tienes suficientes monedas para Auto Roll!");
        return;
      }
      gameState.autoRollActive = true;
      document.getElementById("autoRollControls").style.display = "block";
      playSound(500,0.2);
      gameState.autoRollInterval = setInterval(() => {
        if(gameState.coins >= 50) { roll(); }
        else { stopAutoRoll(); alert("¬°Auto Roll detenido! No tienes suficientes monedas."); }
      }, 1000);
    }
    
    function stopAutoRoll() {
      gameState.autoRollActive = false;
      document.getElementById("autoRollControls").style.display = "none";
      if(gameState.autoRollInterval) { clearInterval(gameState.autoRollInterval); gameState.autoRollInterval = null; }
      playSound(300,0.3);
    }
    
    //////////////////////////////
    // Compras en la tienda
    //////////////////////////////
    function buyLuckUpgrade(increase, cost) {
      if(gameState.coins >= cost) {
        gameState.coins -= cost;
        gameState.luck += increase;
        playSound(600,0.5,"triangle");
        updateUI();
        alert(`¬°Mejora de suerte comprada! +${increase}x suerte permanente.`);
      } else { playSound(200,0.3); alert("¬°No tienes suficientes monedas!"); }
    }
    
    function buyPotion(multiplier, duration, cost) {
      if(gameState.coins >= cost) {
        gameState.coins -= cost;
        gameState.potionActive = true;
        gameState.potionMultiplier = multiplier;
        gameState.potionEndTime = Date.now() + duration;
        playSound(700,0.8,"sine");
        updateUI();
        alert(`¬°Poci√≥n activada! +${multiplier}x suerte por ${duration/1000} segundos.`);
        const potionInterval = setInterval(() => {
          if(Date.now() >= gameState.potionEndTime) {
            clearInterval(potionInterval);
            gameState.potionActive = false;
            gameState.potionMultiplier = 0;
            updateUI();
            alert("¬°Efecto de poci√≥n terminado!");
          } else { updateUI(); }
        }, 1000);
      } else { playSound(200,0.3); alert("¬°No tienes suficientes monedas!"); }
    }
    
    // Compra de poci√≥n de un solo uso (OP)
    function buyOneUsePotion(multiplier, duration, cost) {
      if(gameState.coins >= cost) {
        gameState.coins -= cost;
        gameState.oneUsePotions = (gameState.oneUsePotions || 0) + 1;
        playSound(750,0.6,"triangle");
        updateUI();
        alert(`¬°Has comprado una Poci√≥n OP! √ösala cuando quieras para +${multiplier}x suerte por ${duration/1000} segundos.`);
      } else { playSound(200,0.3); alert("¬°No tienes suficientes monedas!"); }
    }
    
    //////////////////////////////
    // Prestigio y Logros
    //////////////////////////////
    function prestigeGame() {
      if(confirm("Prestigiar reiniciar√° tu progreso a cambio de un bono permanente de suerte. ¬øContinuar?")) {
        gameState.prestige++;
        // Bono de suerte por cada prestigio
        gameState.luck += 0.2;
        // Reiniciar variables principales (excepto prestigio, username y avatar)
        gameState.coins = 1000;
        gameState.totalRolls = 0;
        gameState.auras = [];
        gameState.bestAura = 0;
        updateUI();
        updateInventory();
        alert(`¬°Prestigio completado! Ahora tienes prestigio ${gameState.prestige} y +0.2 suerte permanente.`);
      }
    }
    
    // Logros: ejemplo simple
    function updateAchievements() {
      let achievements = [];
      if(gameState.totalRolls >= 1) achievements.push("Primer Roll");
      if(gameState.totalRolls >= 10) achievements.push("10 Rolls Realizados");
      if(gameState.bestAura >= 100000) achievements.push("Aura Legendaria");
      if(gameState.auras.length >= 50) achievements.push("Coleccionista: 50 auras");
      gameState.achievements = achievements;
      const list = document.getElementById("achievementsList");
      if(achievements.length === 0) { list.innerHTML = "<p>No has conseguido logros a√∫n.</p>"; }
      else { list.innerHTML = achievements.map(a => `<p>${a}</p>`).join(''); }
    }
    
    //////////////////////////////
    // Leaderboard (guardado en localStorage)
    //////////////////////////////
    function updateLeaderboard() {
      if(!gameState.username) return;
      // Obtener leaderboard de localStorage
      let leaderboard = JSON.parse(localStorage.getItem("auraGameLeaderboard") || "[]");
      // Actualiza o a√±ade el usuario
      let found = leaderboard.find(u => u.username === gameState.username);
      if(found) {
        if(gameState.bestAura > found.bestAura) { found.bestAura = gameState.bestAura; }
      } else {
        leaderboard.push({ username: gameState.username, avatar: gameState.avatar, bestAura: gameState.bestAura });
      }
      // Ordena por mejor aura
      leaderboard.sort((a,b) => b.bestAura - a.bestAura);
      localStorage.setItem("auraGameLeaderboard", JSON.stringify(leaderboard));
      // Actualiza la UI
      const board = document.getElementById("leaderboardList");
      if(leaderboard.length === 0) { board.innerHTML = "<p>No hay datos a√∫n.</p>"; }
      else {
        let html = "<table style='width:100%; color:#fff;'><tr><th>Usuario</th><th>Mejor Aura</th></tr>";
        leaderboard.forEach(u => {
          html += `<tr>
                     <td style="display:flex; align-items:center; gap:10px;">
                       ${u.avatar ? `<img src="${u.avatar}" style="width:30px; height:30px; border-radius:50%;" />` : ""}
                       ${u.username}
                     </td>
                     <td>${u.bestAura.toLocaleString()}</td>
                   </tr>`;
        });
        html += "</table>";
        board.innerHTML = html;
      }
    }
    
    //////////////////////////////
    // Sistema de C√≥digos
    //////////////////////////////
    function redeemCode() {
      const code = document.getElementById("codeInput").value.trim();
      const messageDiv = document.getElementById("codeMessage");
      if(!code) { messageDiv.textContent = "Ingresa un c√≥digo."; return; }
      if(gameState.codesRedeemed.includes(code)) {
        messageDiv.textContent = "C√≥digo ya utilizado.";
        return;
      }
      if(code === "Release") {
        gameState.coins += 5000;
        gameState.luck += 0.5;
        gameState.codesRedeemed.push(code);
        messageDiv.textContent = "C√≥digo 'Release' canjeado: +5000 monedas y +0.5 suerte.";
      } else if(code === "Test") {
        // C√≥digo secreto, muy OP
        gameState.coins += 100000;
        gameState.luck += 5;
        gameState.codesRedeemed.push(code);
        messageDiv.textContent = "C√≥digo secreto 'Test' canjeado: ¬°Recompensa OP activada!";
      } else {
        messageDiv.textContent = "C√≥digo inv√°lido.";
      }
      updateUI();
      saveGame();
    }
    
    //////////////////////////////
    // Cambio entre pesta√±as
    //////////////////////////////
    function switchTab(tab, event) {
      playSound(400,0.1);
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove("active"));
      document.querySelectorAll('.tab').forEach(btn => btn.classList.remove("active"));
      document.getElementById(tab + "-tab").classList.add("active");
      event.target.classList.add("active");
    }
    
    //////////////////////////////
    // A√±adir click sound a botones y pesta√±as
    //////////////////////////////
    document.querySelectorAll('.btn, .tab').forEach(btn => {
      btn.addEventListener("click", () => { playSound(350,0.1); });
    });
    
    //////////////////////////////
    // Inicializaciones
    //////////////////////////////
    loadGame();
    updateUI();
    updateInventory();
    updateAchievements();
    
    function updateInventory() {
      const inventoryGrid = document.getElementById("inventoryGrid");
      if(gameState.auras.length === 0) {
        inventoryGrid.innerHTML = '<p style="text-align:center; opacity:0.7; grid-column:1/-1;">Tu inventario est√° vac√≠o. ¬°Haz algunos rolls para conseguir auras!</p>';
        return;
      }
      // Agrupar auras iguales
      const grouped = {};
      gameState.auras.forEach(aura => {
        const key = aura.name + "-" + aura.rarity;
        if(!grouped[key]) { grouped[key] = { ...aura, count: 0, totalValue: 0, bestValue: 0 }; }
        grouped[key].count++;
        grouped[key].totalValue += aura.value;
        grouped[key].bestValue = Math.max(grouped[key].bestValue, aura.value);
      });
      const sorted = Object.values(grouped).sort((a,b) => b.bestValue - a.bestValue);
      inventoryGrid.innerHTML = sorted.map(a => `
        <div class="inventory-item rarity-${a.rarity.toLowerCase()}">
          <h3>${a.name}</h3>
          <p>${a.rarity}</p>
          <p>Cantidad: ${a.count}</p>
          <p>Mejor: ${a.bestValue.toLocaleString()}</p>
          <p>Total: ${a.totalValue.toLocaleString()}</p>
        </div>
      `).join('');
    }
    
    // Guarda la partida cuando se cierra la ventana
    window.addEventListener("beforeunload", saveGame);
    
    console.log("üéÆ Aura RNG Game Extended cargado! ¬°Disfruta y s√© muy afortunado!");
  </script>
</body>
</html>
